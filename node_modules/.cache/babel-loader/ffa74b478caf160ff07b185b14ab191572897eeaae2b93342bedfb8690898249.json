{"ast":null,"code":"import React,{useState,useEffect}from'react';import CompleteLoginFlow from'./CompleteLoginFlow';import BeautifulDarkLanding from'./BeautifulDarkLanding';import ApiService from'../services/api';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const AppFlow=()=>{const[isLoggedIn,setIsLoggedIn]=useState(false);const[currentUser,setCurrentUser]=useState(null);const[isLoading,setIsLoading]=useState(true);// Check for existing authentication on component mount\nuseEffect(()=>{const checkAuthStatus=async()=>{try{const token=localStorage.getItem('authToken');if(token){// Try to validate the token using check-session endpoint\nconst sessionResponse=await ApiService.checkSession();if(sessionResponse&&sessionResponse.success){// Transform the session response to match the expected user structure\nconst userData={name:sessionResponse.profile.displayName,email:sessionResponse.profile.email,role:sessionResponse.profile.role,profile:sessionResponse.profile// Note: BeautifulDarkLanding uses its own permissions object based on role\n};console.log('Session response:',sessionResponse);console.log('Transformed user data:',userData);setCurrentUser(userData);setIsLoggedIn(true);}else{// Token is invalid, clear it\nlocalStorage.removeItem('authToken');ApiService.setToken(null);}}}catch(error){console.error('Auth check failed:',error);// Clear invalid token\nlocalStorage.removeItem('authToken');ApiService.setToken(null);}finally{setIsLoading(false);}};checkAuthStatus();},[]);const handleLoginSuccess=user=>{setCurrentUser(user);setIsLoggedIn(true);};const handleLogout=async()=>{try{await ApiService.logout();}catch(error){console.error('Logout error:',error);}finally{setCurrentUser(null);setIsLoggedIn(false);}};// Show loading state while checking authentication\nif(isLoading){return/*#__PURE__*/_jsx(\"div\",{className:\"min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-black flex items-center justify-center\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-300\",children:\"Loading...\"})]})});}if(!isLoggedIn){return/*#__PURE__*/_jsx(CompleteLoginFlow,{onLoginSuccess:handleLoginSuccess});}// Ensure currentUser has the required properties before rendering BeautifulDarkLanding\nif(!currentUser||!currentUser.role){return/*#__PURE__*/_jsx(\"div\",{className:\"min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-black flex items-center justify-center\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-300\",children:\"Loading user data...\"})]})});}return/*#__PURE__*/_jsx(BeautifulDarkLanding,{currentUser:currentUser,onLogout:handleLogout});};export default AppFlow;","map":{"version":3,"names":["React","useState","useEffect","CompleteLoginFlow","BeautifulDarkLanding","ApiService","jsx","_jsx","jsxs","_jsxs","AppFlow","isLoggedIn","setIsLoggedIn","currentUser","setCurrentUser","isLoading","setIsLoading","checkAuthStatus","token","localStorage","getItem","sessionResponse","checkSession","success","userData","name","profile","displayName","email","role","console","log","removeItem","setToken","error","handleLoginSuccess","user","handleLogout","logout","className","children","onLoginSuccess","onLogout"],"sources":["/Users/bsauer02/Desktop/Opis3.0/rp-exotics-frontend-only/src/components/AppFlow.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport CompleteLoginFlow from './CompleteLoginFlow';\nimport BeautifulDarkLanding from './BeautifulDarkLanding';\nimport ApiService from '../services/api';\n\nconst AppFlow = () => {\n  const [isLoggedIn, setIsLoggedIn] = useState(false);\n  const [currentUser, setCurrentUser] = useState(null);\n  const [isLoading, setIsLoading] = useState(true);\n\n  // Check for existing authentication on component mount\n  useEffect(() => {\n    const checkAuthStatus = async () => {\n      try {\n        const token = localStorage.getItem('authToken');\n        if (token) {\n          // Try to validate the token using check-session endpoint\n          const sessionResponse = await ApiService.checkSession();\n          if (sessionResponse && sessionResponse.success) {\n            // Transform the session response to match the expected user structure\n            const userData = {\n              name: sessionResponse.profile.displayName,\n              email: sessionResponse.profile.email,\n              role: sessionResponse.profile.role,\n              profile: sessionResponse.profile\n              // Note: BeautifulDarkLanding uses its own permissions object based on role\n            };\n            console.log('Session response:', sessionResponse);\n            console.log('Transformed user data:', userData);\n            setCurrentUser(userData);\n            setIsLoggedIn(true);\n          } else {\n            // Token is invalid, clear it\n            localStorage.removeItem('authToken');\n            ApiService.setToken(null);\n          }\n        }\n      } catch (error) {\n        console.error('Auth check failed:', error);\n        // Clear invalid token\n        localStorage.removeItem('authToken');\n        ApiService.setToken(null);\n      } finally {\n        setIsLoading(false);\n      }\n    };\n\n    checkAuthStatus();\n  }, []);\n\n  const handleLoginSuccess = (user) => {\n    setCurrentUser(user);\n    setIsLoggedIn(true);\n  };\n\n  const handleLogout = async () => {\n    try {\n      await ApiService.logout();\n    } catch (error) {\n      console.error('Logout error:', error);\n    } finally {\n      setCurrentUser(null);\n      setIsLoggedIn(false);\n    }\n  };\n\n  // Show loading state while checking authentication\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-black flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4\"></div>\n          <p className=\"text-gray-300\">Loading...</p>\n        </div>\n      </div>\n    );\n  }\n\n  if (!isLoggedIn) {\n    return <CompleteLoginFlow onLoginSuccess={handleLoginSuccess} />;\n  }\n\n  // Ensure currentUser has the required properties before rendering BeautifulDarkLanding\n  if (!currentUser || !currentUser.role) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-black flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4\"></div>\n          <p className=\"text-gray-300\">Loading user data...</p>\n        </div>\n      </div>\n    );\n  }\n\n  return <BeautifulDarkLanding currentUser={currentUser} onLogout={handleLogout} />;\n};\n\nexport default AppFlow; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}